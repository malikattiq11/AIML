<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Federated Learning: Training AI Without Sharing Your Data | AI Ml</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Federated Learning: Training AI Without Sharing Your Data" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Federated Learning: Training AI Without Sharing Your Data" />
<meta property="og:description" content="Federated Learning: Training AI Without Sharing Your Data" />
<link rel="canonical" href="https://malikattiq11.github.io//AIML/ai/2024/10/28/federated-learning-blog.html" />
<meta property="og:url" content="https://malikattiq11.github.io//AIML/ai/2024/10/28/federated-learning-blog.html" />
<meta property="og:site_name" content="AI Ml" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-28T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Federated Learning: Training AI Without Sharing Your Data" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-10-28T00:00:00+00:00","datePublished":"2024-10-28T00:00:00+00:00","description":"Federated Learning: Training AI Without Sharing Your Data","headline":"Federated Learning: Training AI Without Sharing Your Data","mainEntityOfPage":{"@type":"WebPage","@id":"https://malikattiq11.github.io//AIML/ai/2024/10/28/federated-learning-blog.html"},"url":"https://malikattiq11.github.io//AIML/ai/2024/10/28/federated-learning-blog.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/AIML/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://malikattiq11.github.io//AIML/feed.xml" title="AI Ml" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/AIML/">AI Ml</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/AIML/about/">About</a><a class="page-link" href="/AIML/blog/">Blog</a><a class="page-link" href="/AIML/projects/">Projects</a><a class="page-link" href="/AIML/wiki.html">Machine Learning and Data Mining</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Federated Learning: Training AI Without Sharing Your Data
</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-10-28T00:00:00+00:00" itemprop="datePublished">Oct 28, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="federated-learning-training-ai-without-sharing-your-data">Federated Learning: Training AI Without Sharing Your Data</h1>

<h2 id="what-is-federated-learning">What is Federated Learning?</h2>

<p>Imagine you’re trying to build a smart keyboard that predicts the next word you’ll type. But there’s a catch - you can’t peek at anyone’s private messages. That’s where federated learning comes in. Instead of sending all the data to a central server, the AI model travels to each device, learns locally, and only shares the lessons learned, not the actual data.</p>

<h2 id="why-is-it-revolutionary">Why is it Revolutionary?</h2>

<ol>
  <li><strong>Privacy</strong>: Your data never leaves your device</li>
  <li><strong>Efficiency</strong>: Leverages millions of devices for training</li>
  <li><strong>Personalization</strong>: Models can adapt to local usage patterns</li>
</ol>

<h2 id="how-does-it-work-a-simple-example">How Does it Work? A Simple Example</h2>

<p>Let’s break it down with Python code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>

<span class="k">class</span> <span class="nc">Device</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">local_data</span><span class="p">,</span> <span class="n">local_labels</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">local_data</span>
        <span class="n">self</span><span class="p">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">local_labels</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">train_local_model</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">global_model</span><span class="p">):</span>
        <span class="c1"># Copy global model parameters
</span>        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="nf">clone_model</span><span class="p">(</span><span class="n">global_model</span><span class="p">)</span>
        <span class="c1"># Train on local data
</span>        <span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">partial_fit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">get_model_params</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">clone_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nc">SGDClassifier</span><span class="p">(</span><span class="n">warm_start</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">new_model</span> <span class="o">=</span> <span class="nc">SGDClassifier</span><span class="p">(</span><span class="n">warm_start</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">new_model</span><span class="p">.</span><span class="n">coef_</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">coef_</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    <span class="n">new_model</span><span class="p">.</span><span class="n">intercept_</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">intercept_</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_model</span>

<span class="k">def</span> <span class="nf">get_model_params</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">coef</span><span class="sh">"</span><span class="p">:</span> <span class="n">model</span><span class="p">.</span><span class="n">coef_</span><span class="p">.</span><span class="nf">copy</span><span class="p">(),</span> 
            <span class="sh">"</span><span class="s">intercept</span><span class="sh">"</span><span class="p">:</span> <span class="n">model</span><span class="p">.</span><span class="n">intercept_</span><span class="p">.</span><span class="nf">copy</span><span class="p">()}</span>

<span class="k">def</span> <span class="nf">aggregate_models</span><span class="p">(</span><span class="n">model_params_list</span><span class="p">):</span>
    <span class="c1"># Average the parameters from all devices
</span>    <span class="n">avg_coef</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">([</span><span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">coef</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">model_params_list</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">avg_intercept</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">([</span><span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">intercept</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">model_params_list</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">global_model</span> <span class="o">=</span> <span class="nc">SGDClassifier</span><span class="p">(</span><span class="n">warm_start</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">global_model</span><span class="p">.</span><span class="n">coef_</span> <span class="o">=</span> <span class="n">avg_coef</span>
    <span class="n">global_model</span><span class="p">.</span><span class="n">intercept_</span> <span class="o">=</span> <span class="n">avg_intercept</span>
    <span class="k">return</span> <span class="n">global_model</span>

<span class="c1"># Simulate federated learning
</span><span class="k">def</span> <span class="nf">run_federated_learning</span><span class="p">():</span>
    <span class="c1"># Create simulated devices with local data
</span>    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nc">Device</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)),</span>
        <span class="nc">Device</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)),</span>
        <span class="nc">Device</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
    <span class="p">]</span>
    
    <span class="n">global_model</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">for</span> <span class="nb">round</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c1"># 5 rounds of training
</span>        <span class="n">local_models</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Train on each device
</span>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">local_params</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="nf">train_local_model</span><span class="p">(</span><span class="n">global_model</span><span class="p">)</span>
            <span class="n">local_models</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">local_params</span><span class="p">)</span>
        
        <span class="c1"># Aggregate models
</span>        <span class="n">global_model</span> <span class="o">=</span> <span class="nf">aggregate_models</span><span class="p">(</span><span class="n">local_models</span><span class="p">)</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Round </span><span class="si">{</span><span class="nb">round</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s"> completed</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">global_model</span>

<span class="c1"># Run the simulation
</span><span class="n">final_model</span> <span class="o">=</span> <span class="nf">run_federated_learning</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="real-world-applications">Real-World Applications</h2>

<h3 id="1-next-word-prediction">1. Next Word Prediction</h3>
<p>Google’s Gboard uses federated learning to improve keyboard predictions:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">KeyboardDevice</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_texts</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">texts</span> <span class="o">=</span> <span class="n">user_texts</span>
        <span class="n">self</span><span class="p">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">train_local_model</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">texts</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="nf">split</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">vocab</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">words</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">words</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">vocab</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">vocab</span><span class="p">,</span> <span class="sh">"</span><span class="s">bigrams</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">bigrams</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">aggregate_keyboard_models</span><span class="p">(</span><span class="n">local_models</span><span class="p">):</span>
    <span class="n">global_vocab</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
    <span class="n">global_bigrams</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">local_models</span><span class="p">:</span>
        <span class="n">global_vocab</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="sh">"</span><span class="s">vocab</span><span class="sh">"</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">word1</span><span class="p">,</span> <span class="n">next_words</span> <span class="ow">in</span> <span class="n">model</span><span class="p">[</span><span class="sh">"</span><span class="s">bigrams</span><span class="sh">"</span><span class="p">].</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">word1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_bigrams</span><span class="p">:</span>
                <span class="n">global_bigrams</span><span class="p">[</span><span class="n">word1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">word2</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">next_words</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">word2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_bigrams</span><span class="p">[</span><span class="n">word1</span><span class="p">]:</span>
                    <span class="n">global_bigrams</span><span class="p">[</span><span class="n">word1</span><span class="p">][</span><span class="n">word2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">global_bigrams</span><span class="p">[</span><span class="n">word1</span><span class="p">][</span><span class="n">word2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">count</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">vocab</span><span class="sh">"</span><span class="p">:</span> <span class="n">global_vocab</span><span class="p">,</span> <span class="sh">"</span><span class="s">bigrams</span><span class="sh">"</span><span class="p">:</span> <span class="n">global_bigrams</span><span class="p">}</span>

<span class="c1"># Example usage
</span><span class="n">devices</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nc">KeyboardDevice</span><span class="p">([</span><span class="sh">"</span><span class="s">hello world</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">hello there</span><span class="sh">"</span><span class="p">]),</span>
    <span class="nc">KeyboardDevice</span><span class="p">([</span><span class="sh">"</span><span class="s">world news</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">hello friend</span><span class="sh">"</span><span class="p">]),</span>
    <span class="nc">KeyboardDevice</span><span class="p">([</span><span class="sh">"</span><span class="s">my friend</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">hello world</span><span class="sh">"</span><span class="p">])</span>
<span class="p">]</span>

<span class="n">local_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">.</span><span class="nf">train_local_model</span><span class="p">()</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>
<span class="n">global_model</span> <span class="o">=</span> <span class="nf">aggregate_keyboard_models</span><span class="p">(</span><span class="n">local_models</span><span class="p">)</span>

<span class="c1"># Predict next word
</span><span class="k">def</span> <span class="nf">predict_next_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model</span><span class="p">[</span><span class="sh">"</span><span class="s">bigrams</span><span class="sh">"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">next_words</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="sh">"</span><span class="s">bigrams</span><span class="sh">"</span><span class="p">][</span><span class="n">word</span><span class="p">]</span>
    <span class="k">return</span> <span class="nf">max</span><span class="p">(</span><span class="n">next_words</span><span class="p">.</span><span class="nf">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">predict_next_word</span><span class="p">(</span><span class="sh">"</span><span class="s">hello</span><span class="sh">"</span><span class="p">,</span> <span class="n">global_model</span><span class="p">))</span>  <span class="c1"># Might print "world"
</span></code></pre></div></div>

<h3 id="2-healthcare-analytics">2. Healthcare Analytics</h3>
<p>Hospitals can collaborate without sharing patient data:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Hospital</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">patient_data</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">patient_data</span>
        
    <span class="k">def</span> <span class="nf">train_local_model</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">global_model</span><span class="p">):</span>
        <span class="c1"># Train a model on local patient data
</span>        <span class="n">local_model</span> <span class="o">=</span> <span class="nf">clone_model</span><span class="p">(</span><span class="n">global_model</span><span class="p">)</span>
        <span class="n">local_model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">features</span><span class="sh">"</span><span class="p">],</span> <span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">labels</span><span class="sh">"</span><span class="p">])</span>
        <span class="k">return</span> <span class="nf">get_model_params</span><span class="p">(</span><span class="n">local_model</span><span class="p">)</span>

<span class="c1"># Example usage
</span><span class="n">hospital1</span> <span class="o">=</span> <span class="nc">Hospital</span><span class="p">({</span>
    <span class="sh">"</span><span class="s">features</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="sh">"</span><span class="s">labels</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">hospital2</span> <span class="o">=</span> <span class="nc">Hospital</span><span class="p">({</span>
    <span class="sh">"</span><span class="s">features</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="sh">"</span><span class="s">labels</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<h2 id="challenges-and-solutions">Challenges and Solutions</h2>

<h3 id="1-communication-overhead">1. Communication Overhead</h3>
<p>Problem: Sending model updates can be bandwidth-intensive</p>

<p>Solution: Model compression</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">compress_model_update</span><span class="p">(</span><span class="n">model_params</span><span class="p">):</span>
    <span class="n">compressed</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">coef</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">around</span><span class="p">(</span><span class="n">model_params</span><span class="p">[</span><span class="sh">"</span><span class="s">coef</span><span class="sh">"</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">intercept</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">around</span><span class="p">(</span><span class="n">model_params</span><span class="p">[</span><span class="sh">"</span><span class="s">intercept</span><span class="sh">"</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">compressed</span>

<span class="c1"># Usage in device training
</span><span class="k">def</span> <span class="nf">train_local_model</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">global_model</span><span class="p">):</span>
    <span class="n">local_model</span> <span class="o">=</span> <span class="nf">clone_model</span><span class="p">(</span><span class="n">global_model</span><span class="p">)</span>
    <span class="n">local_model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">compress_model_update</span><span class="p">(</span><span class="nf">get_model_params</span><span class="p">(</span><span class="n">local_model</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="2-non-iid-data">2. Non-IID Data</h3>
<p>Problem: Different devices may have very different data distributions</p>

<p>Solution: Federated averaging with weighted updates</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">weighted_aggregate_models</span><span class="p">(</span><span class="n">model_params_list</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">avg_coef</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">average</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">coef</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model_params_list</span><span class="p">],</span> 
                          <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">avg_intercept</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">average</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="sh">"</span><span class="s">intercept</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model_params_list</span><span class="p">],</span> 
                               <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">global_model</span> <span class="o">=</span> <span class="nc">SGDClassifier</span><span class="p">(</span><span class="n">warm_start</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">global_model</span><span class="p">.</span><span class="n">coef_</span> <span class="o">=</span> <span class="n">avg_coef</span>
    <span class="n">global_model</span><span class="p">.</span><span class="n">intercept_</span> <span class="o">=</span> <span class="n">avg_intercept</span>
    <span class="k">return</span> <span class="n">global_model</span>
</code></pre></div></div>

<h2 id="best-practices">Best Practices</h2>

<ol>
  <li><strong>Regular Communication Rounds</strong>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">training_schedule</span><span class="p">(</span><span class="n">num_rounds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_devices</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
 <span class="n">available_devices</span> <span class="o">=</span> <span class="nf">get_available_devices</span><span class="p">()</span>
 <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">available_devices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_devices</span><span class="p">:</span>
     <span class="k">return</span> <span class="bp">False</span>
    
 <span class="k">for</span> <span class="nb">round</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_rounds</span><span class="p">):</span>
     <span class="n">selected_devices</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">available_devices</span><span class="p">,</span> <span class="n">min_devices</span><span class="p">)</span>
     <span class="nf">train_round</span><span class="p">(</span><span class="n">selected_devices</span><span class="p">)</span>
 <span class="k">return</span> <span class="bp">True</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Secure Aggregation</strong>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">secure_aggregate</span><span class="p">(</span><span class="n">model_updates</span><span class="p">):</span>
 <span class="c1"># Simplified secure aggregation
</span> <span class="n">noise_scale</span> <span class="o">=</span> <span class="mf">0.01</span>
 <span class="n">secure_updates</span> <span class="o">=</span> <span class="p">[]</span>
    
 <span class="k">for</span> <span class="n">update</span> <span class="ow">in</span> <span class="n">model_updates</span><span class="p">:</span>
     <span class="n">noisy_update</span> <span class="o">=</span> <span class="p">{</span>
         <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">update</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span>
     <span class="p">}</span>
     <span class="n">secure_updates</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">noisy_update</span><span class="p">)</span>
    
 <span class="k">return</span> <span class="nf">aggregate_models</span><span class="p">(</span><span class="n">secure_updates</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="tools-and-frameworks">Tools and Frameworks</h2>

<ol>
  <li><strong>TensorFlow Federated</strong>
```python
import tensorflow_federated as tff</li>
</ol>

<h1 id="define-a-simple-model">Define a simple model</h1>
<p>def create_keras_model():
    return tf.keras.models.Sequential([
        tf.keras.layers.Dense(10, activation=tf.nn.relu),
        tf.keras.layers.Dense(1, activation=tf.nn.sigmoid)
    ])</p>

<h1 id="create-a-federated-training-process">Create a federated training process</h1>
<p>def model_fn():
    keras_model = create_keras_model()
    return tff.learning.from_keras_model(
        keras_model,
        input_spec=train_data[0].element_spec,
        loss=tf.keras.losses.BinaryCrossentropy(),
        metrics=[tf.keras.metrics.BinaryAccuracy()]
    )</p>

<p>federated_algorithm = tff.learning.build_federated_averaging_process(
    model_fn,
    client_optimizer_fn=lambda: tf.keras.optimizers.SGD(0.1)
)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
2. **PySyft**
```python
import syft as sy

hook = sy.TorchHook(torch)
bob = sy.VirtualWorker(hook, id="bob")
alice = sy.VirtualWorker(hook, id="alice")

# Create and send data to virtual workers
data = torch.tensor([1, 2, 3, 4, 5])
bob_data = data.send(bob)
alice_data = data.send(alice)

# Perform federated computation
aggregated_data = (bob_data + alice_data).get()
</code></pre></div></div>


  </div><a class="u-url" href="/AIML/ai/2024/10/28/federated-learning-blog.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/AIML/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AI Ml</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">AI Ml</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
